<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
    html, body {
      padding: 0;
      margin: 0;
      overflow: hidden;
      background: black;
    }
    #player {
      width: 100vw;
      height: 100vh;
    }
    </style>
  </head>

  <body>
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <div id="player"></div>

    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
    <script src="underscore-min.js"></script>

    <script>
      /*
      https://developers.google.com/youtube/js_api_reference
      https://developers.google.com/youtube/player_parameters?playerVersion=HTML5
      https://developers.google.com/youtube/player_parameters
      */
      // Test error by going to video "91 - Transformation" in playlist PL4166A6B67CF5C6AE


      //var env = 'test';
      var env = 'production';

      var envConfig = {
        test: {
          playbackQuality: 'hd720',
          playerWidth: '1280',
          playerHeight: '720',
          showinfo: '1',
          controls: '1',
          mute: false
        },
        production: {
          playerWidth: '1024',
          playerHeight: '600',
          playbackQuality: 'large',
          showinfo: '0',
          controls: '0',
          mute: true
        }
      }

      var config = envConfig[env];

      var playlists = [
        'PL4166A6B67CF5C6AE', // Time lapse
        'PLgTLZSbwbEZx50O61ogD2z9a6a0ZvohJQ', // Time lapse
        'PLRVpVqA1yzHNL2yXCfnxE7H_EhVDA3CLF', // ISS Time lapse
        'PLkMnGIVT8gLVOW9WaWOT1v1cclKfwEHsk', // City time lapse
        'PLnuf8iyXggLEGxnI1mOXioVeDfMHml_qq', // Red Bull Earth Porn
        'UUwgURKfUA7e0Z7_qE3TvBFQ', // devinsupertramp all videos
        'PLSSPBo7OVSZvJtRrcF5CVSjRkmH9eNWA3', // GoPro Staff's Top Picks
        'PL55DC89E245188F1F', // GoPro Video of the Day!
        'PL8JmD9rOrDD3UbBjJ37KF0x-aA0PImpNY', // People are awesome
        'PLcWzFJqiKcCzaFo07F2kEqEzRBpKjDrXQ', // People are awesome
      ];
      var playlistAt = 0;

      playlists = _.shuffle(playlists);


      // 2. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      var player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: config.playerHeight,
          width: config.playerWidth,
          playerVars: {
            /*autoplay: '1',*/
            fs: '0',
            loop: '1',
            modestbranding: '1',
            iv_load_policy: '3',
            showinfo: config.showinfo,
            controls: config.controls,
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange,
            'onError': onError
          }
        });
      }

      function advancePlaylist() {
        var playlist = playlists[playlistAt % playlists.length];
        player.cuePlaylist({
          list: playlist,
          suggestedQuality: config.playbackQuality
        });
      }

      function onPlayerReady(event) {
        if (config.mute) player.mute();
        advancePlaylist();
      }

      function onError(event) {
        var id = event.data;
        console.log('YouTube error', id);
        if (id == 100 || id == 101 || id == 150) {
          setTimeout(function() {
            player.nextVideo();
          }, 1000);
        }
        else {
          console.log('Unhandled YouTube error', id);
          setTimeout(function() {
            location.reload();
          }, 5000);
        }
      }

      function onPlayerStateChange(event) {
        //console.log(event.data);
        if (event.data == YT.PlayerState.PLAYING) {
          player.setPlaybackQuality(config.playbackQuality);
          //player.setPlaybackRate(0.5);
        }
        else if (event.data == YT.PlayerState.CUED) {
          player.setShuffle(true);
          player.playVideoAt(0);
        }
        else if (event.data == YT.PlayerState.ENDED) {
          playlistAt++;
          advancePlaylist();
        }
      }
    </script>
  </body>
</html>
